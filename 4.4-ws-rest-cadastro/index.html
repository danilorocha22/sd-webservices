<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="por Manoel Campos da Silva Filho">
<title>Desenvolvimento Web Services REST em Java utilizando JAX-RS com JPA e CDI no NetBeans</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Desenvolvimento Web Services REST em Java utilizando JAX-RS com JPA e CDI no NetBeans</h1>
<div class="details">
<span id="author" class="author">por Manoel Campos da Silva Filho</span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>REST se tornou o padrão de fato para o desenvolvimento de Web Services (WS&#8217;s) há alguns anos, em oposição ao protocolo SOAP padronizado pela W3C.
Isto se deve a diversos fatores como:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Troca de mensagens simplificadas entre cliente e servidor, normalmente utilizando JSON no lugar de XML. Isto faz com o tráfego de dados e o delay causado pela troca de mensagens sejam reduzidos. Tais características são fundamentais para dispositivos móveis que normalmente possui pacotes de dados com franquia de tráfego e velocidade limitados.</p>
</li>
<li>
<p>Utilização apenas dos recursos do protocolo HTTP para troca de mensagens, sem precisar empacotar os dados da requisição no cabeçalho de outro protocolo como o SOAP, que apenas aumenta o tamanho dos pacotes de dados sendo enviados.</p>
</li>
<li>
<p>Utilização de URLs convencionalmente amigáveis, tornando muito simples o teste de clientes REST utilizando ferramentas de linha de comando como curl ou outras como plugins para navegadores.</p>
</li>
<li>
<p>Ampla adoção pelo mercado, tornando-o um padrão de fato, amplamente suportado pela comunidade de software livre com a disponibilização de inúmeras bibliotecas e suporte nos mais conhecidos IDEs do mercado.</p>
</li>
<li>
<p>Grandes empresas como Google, Facebook, Twitter, Yahoo e muitas outras fornecem incontáveis serviços REST para as mais variadas finalidades. Tais WS&#8217;s fornecem desde integração com serviços como Google Maps, YouTube e Google Translator, informações sobre previsão do tempo e cotação de moedas (inclusive de criptomoedas como Bitcoin), etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Por estes motivos, o protocolo SOAP se tornou absoleto, dando lugar ao REST. Desta forma, neste tutorial será mostrado o desenvolvimento de uma aplicação servidora e outra cliente utilizando o padrão REST. Será mostrado um passo-a-passo para criar as aplicações do zero, explicando as tecnologias utilizadas e configurações necessárias. Então vamos lá.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ferramentas_necessárias">1. Ferramentas Necessárias</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Para este projeto vamos utilizar as versões estáveis mais recentes das ferramentas apresentadas, como listado abaixo:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>JDK 1.8</p>
</li>
<li>
<p>IDE NetBeans 8.2 para Java EE para desenvolvimento do projeto</p>
</li>
<li>
<p>Servidor de aplicação GlassFish 5.0</p>
</li>
<li>
<p>MySQL Server 5 ou superior</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Considera-se que você já tem os itens 1 e 2 previamente instalados.</p>
</div>
<div class="sect2">
<h3 id="_mysql_server">1.1. MySQL Server</h3>
<div class="paragraph">
<p>Nossa aplicação servidora utilizará um banco de dados (BD) MySQL, apesar que qualquer outro banco pode ser utilizado. Se estiver utilizando Linux, como Ubuntu, basta fazer o download do MySQL Server via apt-get com o comando abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo apt-get install mysql-server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se estiver usando Windows ou macOS, pode baixar o instalador do
MySQL Server Community <a href="https://dev.mysql.com/downloads/mysql/">aqui</a>.</p>
</div>
<div class="sect3">
<h4 id="_criando_o_banco_de_dados">1.1.1. Criando o Banco de Dados</h4>
<div class="paragraph">
<p>Utilize o NetBeans para criar o banco de dados chamado <code>cadastro-rest</code> para o nosso sistema, acessando a aba "Services".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-database.gif" alt="create database">
</div>
</div>
<div class="paragraph">
<p>Não precisaremos criar as tabelas manualmente, como veremos a seguir.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_glassfish_5">1.2. GlassFish 5</h3>
<div class="paragraph">
<p>Como vamos usar o GlassFish 5, vamos remover o GlassFish 4 do NetBeans.
Este é um passo opcional. Você pode ter quantos servidores de aplicação
desejar. Mas vamos remover a versão 4 para evitar qualquer confusão.
Para isto, basta ir na aba "Services" no lado esquerdo da janela principal do NetBeans para localizar e remover o GlassFish 4, como mostrado abaixo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/remove-glassfish4.gif" alt="remove glassfish4">
</div>
</div>
<div class="paragraph">
<p>Veja que nas propriedades do servidor é possível verificar em que pasta ele foi instalado (normalmente a pasta de instalação do NetBeans). Caso deseje, pode remover tal pasta também.</p>
</div>
<div class="paragraph">
<p>Baixe o GlassFish 5 <a href="https://javaee.github.io/glassfish/download">aqui</a>. Tenha certeza de baixar a versão completa "GlassFish 5.0 - Full Platform", que possui todas as especificações do JavaEE. Basta descompactar em qualquer lugar que será criada uma pasta <code>glassfish5</code>.</p>
</div>
<div class="paragraph">
<p>Como vamos usar o MySQL como banco de dados, precisaremos do MySQL Connector J, driver JBDC do MySQL (que vai ser utilizado internamente para acesso ao BD). Baixe o driver no <a href="https://dev.mysql.com/downloads/connector/j/">site oficial</a>.</p>
</div>
<div class="paragraph">
<p>Após descompactar o driver, o único arquivo que nos interessa é o <code>mysql-connector-java-X.X.X-bin.jar</code> (onde X.X.X é a versão do driver). Copie tal arquivo para a pasta <code>glassfish5/glassfish/domains/domain1/lib</code> (considerando que <code>glassfish5</code> é a pasta onde descompactou o GlassFish). As bibliotecas colocadas em tal pasta serão carregadas automaticamente pelo GlassFish.</p>
</div>
<div class="paragraph">
<p>Vamos então registrar o GlassFish 5 no NetBeans, indo na aba "Services" e adicionar um novo server no item "Servers", como mostrado a seguir. Observe que não é preciso informar usuário ou senha do GlassFish. Mas o usuário padrão é <code>admin</code> e não possui uma senha.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/register-glassfish5-netbeans.gif" alt="register glassfish5 netbeans">
</div>
</div>
<div class="paragraph">
<p>Observe que após registrar o servidor, o iniciamos em seguida para verificar se tudo correu bem. Depois que o servidor for iniciado e ficar com um botão de "play" verde do lado do seu ícone, podemos abrir o console de administração para verificar se está tudo correto mesmo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/glassfish-admin-console.gif" alt="glassfish admin console">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_estrutura_do_projeto">2. Estrutura do projeto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Utilizaremos o <a href="https://pt.wikipedia.org/wiki/Hibernate">Hibernate</a> como framework de <a href="https://pt.wikipedia.org/wiki/Mapeamento_objeto-relacional">mapeamento objeto relacional (Object Relational Mapping - ORM)</a>, que é uma implementação da especificação <a href="https://pt.wikipedia.org/wiki/Java_Persistence_API">JPA</a>. Ele nos permite esquecer os detalhes relacionados à BDs relacionais (como SQL, Primary Keys (PKs), Foreign Keys (FKs), criação de tabelas, etc) e assim podermos trabalhar exclusivamente em um modelo orientado a objetos, mesmo para manipulação dos dados no banco.</p>
</div>
<div class="paragraph">
<p>A especificação <a href="http://cdi-spec.org">Context and Dependency Injection (CDI)</a> permite que objetos sejam injetados (ou seja, criados automaticamente) onde precisarmos. Tal especificação é implementada por servidores de aplicação como o GlassFish ou WildFly. Podemos fazer o deploy (implantar) aplicações utilizando CDI em Web Containers como Tomcat ou Jetty (que não implementam todas as especificações da plataforma Java EE e logo são mais leves), mas isto requer uma série de configurações.</p>
</div>
<div class="paragraph">
<p>CDI permite diminuir o acoplamento de um software, ou seja, reduz o nível de dependência do nosso projeto. Por exemplo, a partir do momento que utilizamos a especificação JPA como camada de persistência (para salvarmos os dados em algum lugar, neste caso em um BD), se instanciarmos diretamente no nosso código objetos JPA para fazer tais operações, estamos aumentando o nível de dependência do nosso projeto, tornando ele fortemente dependente da JPA. Se precisamos, por exemplo, persistir certos objetos em outro repositório, como em arquivos no disco, precisaríamos instanciar explicitamente objetos diferentes para realizar tal tarefa.</p>
</div>
<div class="paragraph">
<p>Com CDI, podemos simplesmente declarar um objeto e indicar que queremos que uma instância de tal objeto seja injetada automaticamente quando tal objeto precisar ser usado. Com isto, podemos ter uma arquivo de configuração separado que define qual instância será injetada quando um objeto de um determinado tipo for solicitado. Se precisarmos mudar o tipo de objeto (como objetos que usam JPA para persistir dados em um BD por objetos que simplesmente salvam dados em um arquivo), podemos alterar isso em apenas um lugar do código. Observe que utilizei o termo "tipo" e não "classe", uma vez que este tipo pode ser tanto uma classe quanto uma interface, sendo interfaces comumente mais utilizadas.</p>
</div>
<div class="paragraph">
<p>O CDI também nos livra de termos que utilizar o operador <code>new</code> sempre que precisarmos usar um deteminado objeto. Quanto ao servidor de aplicação, o NetBeans 8.2 já disponibiliza o GlassFish 4.1, mas devido a alguns problemas encontrados com tal versão, vamos usar a versão 5.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_o_projeto">3. O projeto</h2>
<div class="sectionbody">
<div class="paragraph">
<p>O projeto que desenvoremos será bem simples. O diagrama de classe abaixo mostra que teremos apenas duas classes de negócio <code>Usuario</code> e <code>Cidade</code>. O servidor disponibilizará um cadastro de usuários por meio de um WS REST. A classe <code>Usuario</code> tem apenas dados básicos e mais um atributo que indica a cidade onde ele mora.</p>
</div>
<div class="paragraph">
<p>Existe uma interface <code>Cadastro</code> que será implementada por todas as classes que representarem tabelas no BD. Tal interface apenas define tais classes devem possui um getter e setter para um atributo <code>id</code> que cada classe de negócio terá. Assim, estamos definindo que todas essas classes devem ter um atributo <code>id</code>, que será bastante útil posteriormente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/class-diagram.jpg" alt="class diagram">
</div>
<div class="title">Figure 1. Diagrama das Classes de Negócio</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_iniciando_o_desenvolvimento">4. Iniciando o Desenvolvimento</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vamos criar um projeto Maven de uma Web Application no NetBeans, como mostra a animação abaixo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-project.gif" alt="create project">
</div>
</div>
<div class="paragraph">
<p>O campo <code>groupId</code> na penúltima tela de criação do projeto foi preenchido com <code>com.manoelcampos</code> indicando um nome de domínio invertido para identificar a empresa ou pessoa que desenvolveu o projeto. Caso você tenha um domínio, pode utilizar. Caso não tenho, pode inventar um ou usar qualquer nome que desejar. O campo <code>package</code> é automaticamente formado pela junção do <code>groupId</code> com o nome dado para o projeto no primeiro campo.</p>
</div>
<div class="paragraph">
<p>Se nunca utilizou Maven antes, esta é uma ferramenta para gerenciamento de dependências no seu projeto, permitindo baixar as dependências indicadas automaticamente. Não confunda com o CDI que usaremos para injeção de dependências. No Maven dizemos quais bibliotecas nosso projeto precisa. Usando CDI, dizemos quais objetos devem ser injetados (automaticamente instanciados) quando precisarmos deles.</p>
</div>
<div class="sect2">
<h3 id="_criando_as_classes_de_negócio">4.1. Criando as classes de negócio</h3>
<div class="paragraph">
<p>Depois de criado o projeto, vamos criar as classes <code>Usuario</code> e <code>Cidade</code> dentro do pacote criado. Primeiro vamos criar a classe <code>Usuario</code> dentro de um subpacote chamado <code>model</code>, onde colocaremos todas as classes de negócio (que representam o modelo do negócio).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/create-business-class.gif" alt="create business class">
</div>
</div>
<div class="paragraph">
<p>Veja que apenas adicionamos <code>.model</code> ao final do nome do pacote ao criar a classe. Agora crie a classe <code>Cidade</code> dentro deste pacote <code>model</code>.</p>
</div>
<div class="paragraph">
<p>Como tais classes representarão tabelas no BD, cada uma delas deve ter um atributo <code>id</code> (neste caso, este id representa uma chave primária simples). Para isso, vamos criar uma interface chamada <code>Cadastro</code> que define métodos getter e setter para este atributo de tais classes. Tal interface ficará no mesmo pacote das classes e terá o seguinte código:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Cadastro {
    long getId();
    void setId(long id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vamos então indicar que nossas classes <code>Usuario</code> e <code>Cidade</code> implementam tal interface.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/implement-interface-methods.gif" alt="implement interface methods">
</div>
</div>
<div class="paragraph">
<p>Como estas classes agora precisam implementar os métodos na interface, podemos usar o NetBeans para incluir o corpo dos métodos pra nós, como mostrado acima. Faça o mesmo para as duas classes de negócio.</p>
</div>
<div class="paragraph">
<p>Nossa classe <code>Usuario</code> terá apenas os atributos abaixo, com os respectivos getters e setters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    private long id;
    private String nome;
    private String cpf;
    private Cidade cidade;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Podemos usar o NetBeans para criar tais métodos para gente. Temos apenas que apagar o código gerado para os métodos <code>getId()</code> e <code>setId()</code> e definir o código apropriado.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/encapsulating-fields.gif" alt="encapsulating fields">
</div>
</div>
<div class="paragraph">
<p>Faça o mesmo para a classe <code>Cidade</code>, definindo os atributos abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    private long id;
    private String nome;
    private String uf;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_utilizando_a_jpa_para_acesso_ao_banco_de_dados">4.2. Utilizando a JPA para acesso ao Banco de Dados</h3>
<div class="paragraph">
<p>Como falado, a JPA é uma especificação Java que provê uma forma padrão para a implementação de frameworks de ORM como o Hibernate. Assim, se usarmos JPA, podemos traocar o framework por qualquer outro que implementa tal especificação, sem precisarmos alterar nosso código fonte (apenas configurações serão necessárias).</p>
</div>
<div class="paragraph">
<p>Para usarmos a JPA, e posteriormente o Hibernate em segundo plano, para fazer toda a comunicação com o BD, precisamos indicar quais classes representam tabelas no BD. Nossas classes de negócio <code>Usuario</code> e <code>Cidade</code> serão as únicas a serem mapeadas para tabelas no banco (por isso chama-se mapeamento objeto-relacional, pois mapeia-se objetos para um BD relacional como o MySQL).</p>
</div>
<div class="paragraph">
<p>Para indicarmos que uma classe será mapeada, precisamos marcá-la com a anotação <code>@Entity</code> da JPA, definindo a classe como uma entidade (uma tabela no BD). Tal anotação precisa ser colocada imediatamente antes da declaração da classe. Após incluí-la, precisaremos importar tal anotação. Novamente podemos usar o NetBeans para isso, clicando na lâmpada que aparece no lado esquerdo da linha, como mostrado abaixo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/define-entity.gif" alt="define entity">
</div>
</div>
<div class="paragraph">
<p>Observe que após salvarmos, é apresentado um erro na linha da declaração da classe. Passando o mouse no erro destacado em vermelho, podemos ver que está sendo indicado que não há nenhum atributo <code>ID</code> para a entidade. Podemos clicar na lâmpada e usar o NetBeans para definir um <code>ID</code>, como mostra a animação acima.</p>
</div>
<div class="paragraph">
<p>Já temos um atributo que chamamos de <code>id</code> e que representa a identificação única de cada objeto da classe (ou seja, a PK na tabela do BD). Assim, apenas indicamos que queremos usar um campo existente como <code>ID</code> e então selecionamos o campo chamado <code>id</code>. Com isto, uma anotação <code>@Id</code> é colocada no campo.</p>
</div>
<div class="paragraph">
<p>Para indicarmos que desejamos que o valor deste campo seja gerado automaticamente no BD (para que ele seja definido como autoincremento no MySQL), vamos adicionar a anotação <code>@GeneretedValue</code>, indicando que a estatégia para geração do valor do campo será <code>IDENTITY</code>. O atributo <code>id</code> deve ficar como abaixo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private long id;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As classes anotadas com <code>@Entity</code> (que a partir de agora, por simplificação chamaremos apenas de Entity) devem implementar a interface <code>Serializable</code>, indicando que objetos de tais classes podem ser persistidos (salvos). Também podemos usar o NetBeans para fazer essa modificação para nós.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/implement-serializable.gif" alt="implement serializable">
</div>
</div>
<div class="paragraph">
<p>O mesmo processo de definir uma entidade, um <code>ID</code> e implementar <code>Serializable</code> deve ser aplicado para todas as classes de negócio.</p>
</div>
</div>
<div class="sect2">
<h3 id="_definindo_uma_persistence_unit_pu">4.3. Definindo uma Persistence Unit (PU)</h3>
<div class="paragraph">
<p>Projetos utilizando JPA precisam conter uma Persistence Unit (PU), que é uma arquivo chamado <code>persistence.xml</code> definindo as configurações para acesso ao BD, controle de transações, provedor de persistência a ser utilizado e outras configurações. Ele é o arquivo de configuração da JPA.</p>
</div>
<div class="paragraph">
<p>Uma vez que já temos algumas Entities no nosso projeto, podemos facilmente adicionar uma PU utilizando o NetBeans.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="800" height="600" src="https://www.youtube.com/embed/7y--ODvjdjQ?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<div class="paragraph">
<p>No vídeo acima, definimos o nome da PU como <code>default</code> (um nome mais simples que o sugerido pelo NetBeans). Como teremos apenas uma PU no nosso projeto (para acessar um único BD), não precisaremos nos preocupar com este nome. Escolhemos o Persistence Provider como Hibernate (JPA 2.1), indicando que o Hibernate será a implementação da JPA que utilizaremos. No campo Data Source devemos escolher ou configurar uma conexão com o BD. Um Data Source (DS) é uma fábrica de conexões com o BD.</p>
</div>
<div class="paragraph">
<p>Temos então que criar primeiro um DS. Chamamos tal DataSource de "cadastro-rest-ds" e selecionamos a conexão com o BD (configurada quando criamos o banco "cadastro-rest"). O nome do DS é utilizado na PU para poder instanciar uma conexão com o banco. Após abrir o arquivo <code>persistence.xml</code> (que representa as configurações da PU), o NetBeans mostra um editor gráfico para tal arquivo.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/persistence-unit.png" alt="persistence unit">
</div>
</div>
<div class="paragraph">
<p>Alguns pontos importantes são:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Persistence Provider</strong>: definimos que desejamos usar Hibernate (como dito antes), como implementação da JPA.</p>
</li>
<li>
<p><strong>Use Java Transaction APIs</strong>: esta opção indica que nossa aplicação usará a JTA. Esta é uma API implementada por servidores de aplicação como o GlassFish, para prover controle automático de transações para nossa aplicação. Isto quer dizer que não teremos que nos preocupar em abrir, cancelar ou confirmar transações no BD. Tudo isso será feito automaticamente pelo GlassFish.</p>
</li>
<li>
<p><strong>Table Generation Strategy</strong>: está como "Create" para permitir que, ao rodar a aplicação, as tabelas sejam criadas no BD automaticamente. Depois que elas tiverem sido criadas, podemos alterar para "None". A opção "Drop and Create" só é interessante se não houver dados que desejamos manter no banco. Assim, sempre que exercutarmos a aplicação, as tabelas serão apagadas e recriadas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Há apenas alguns detalhes que precisamos observar. Se clicarmos no botão "Source" na parte superior do arquivo, podemos visualizar todo o código XML gerado. Quando escolhemos o Hibernate, o valor da tag <code>&lt;provider&gt;</code> foi definido como <code>org.hibernate.ejb.HibernatePersistence</code>, porém, tal provider está obsoleto nas versões atuais do Hibernate e deve ser trocado para <code>org.hibernate.jpa.HibernatePersistenceProvider</code>.</p>
</div>
<div class="paragraph">
<p>O provider representa o nome qualificado (incluindo o nome do pacote) da classe que é capaz de criar objetos <code>EntityManagerFactory</code> e a estrutura de tabelas no BD. Um <code>EntityManagerFactory</code> é uma fábrica de objetos <code>EntityManager</code>. Um <code>EntityManager</code> (EM), por sua vez, é responsável por gerenciar o ciclo de vida das entidades como <code>Usuario</code> e <code>Cidade</code> no nosso sistema. Um EM permite, por exemplo, buscar, incluir, alterar e excluir objetos do BD.</p>
</div>
<div class="paragraph">
<p>Por fim, como indicamos que desejamos usar a JTA, da mesma forma que precisamos indicar qual era a classe que implementa o Persistence Provider, precisamos indicar qual a classe que implementa a JTA Platform, responsável por gerenciar as transações no BD.</p>
</div>
<div class="paragraph">
<p>Como estamos utilizando GlassFish, precisamos adicionar na tag <code>&lt;properties&gt;</code> a seguinte propriedade:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;property name="hibernate.transaction.jta.platform" value="org.hibernate.service.jta.platform.internal.SunOneJtaPlatform"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta é a classe do GlassFish que implementa a JTA Platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configurando_o_cdi">4.4. Configurando o CDI</h3>
<div class="paragraph">
<p>Para permitir o uso de CDI, até o JavaEE 6 era obrigatória a existência de um arquivo chamado <code>beans.xml</code>. A partir do JavaEE 7 tal arquivo não é obrigatório, mas podemos criá-lo se quisermos adicionar algumas configurações para o CDI.</p>
</div>
<div class="paragraph">
<p>Pelo menu <code>File &gt;&gt; New File</code> do NetBeans, podemos digitar <code>beans.xml</code> na janela de pesquisa para criar o arquivo. O arquivo possui um atributo chamado <code>bean-discovery-mode</code> que é definido com valor igual a <code>annotated</code>.</p>
</div>
<div class="paragraph">
<p>Isto indica que só podemos injetar objetos que estejam marcados com alguma anotação que define o escopo dos objetos a serem injetados. Algumas anotações de escopo disponibilizadas pelo CDI, que controlam o ciclo de vida de objetos, são o <code>@ApplicationScoped</code> e <code>@RequestScoped</code>. Um objeto marcado com <code>@ApplicationScoped</code> será criado quando requisitado e só será destruído quando a aplicação for finalizada. Um objeto marcado com <code>@RequestScoped</code> será criado sempre que for requisitado e será destruído ao final da requisição. Se não marcarmos um objeto com nenhum anotação de escopo, seu escopo é <code>@Dependent</code>, que indica que seu ciclo de vida depende do ciclo de vida do objeto onde ele foi criado.</p>
</div>
<div class="paragraph">
<p>Para não sermos obrigamos a anotar todas as classes que desejamos criar objetos por injeção e assim tornar mais fácil o uso de CDI, podemos alterar o valor do atributo para <code>all</code>. Assim, poderemos injetar objetos de qualquer classe que desejarmos.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adicionando_dependências_maven">4.5. Adicionando dependências Maven</h3>
<div class="paragraph">
<p>O arquivo <code>pom.xml</code> (criando automaticamente quando criamos o projeto Maven) é onde indicamos quais são as dependências do nosso projeto. Como estamos utilizando o Hibernate, precisamos incluir as dependências a seguir dentro da tag <code>&lt;dependencies&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate.javax.persistence&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-jpa-2.1-api&lt;/artifactId&gt;
            &lt;version&gt;1.0.2.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
            &lt;version&gt;5.1.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;
            &lt;version&gt;5.1.0.Final&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>O uso de CDI não nos dispensa de declarar as dependências do nosso projeto. O CDI também não vai reduzir o número de dependências. Nosso projeto continua dependendo daquilo que ele usa. O que o CDI garante é que seja fácil trocar a implementação de uma dependência por outra, sem precisar alterar o código, mas somente as configurações como acima.</p>
</div>
<div class="paragraph">
<p>Nosso projeto depende de uma implementação da JPA. Usaremos CDI para injetar objetos que implementam a especificação JPA. Neste caso, tais objetos são de classes implementadas pelo Hibernate, que é o chamado Persistence Provider. Se decidirmos trocar o Hibernate por outra implementação (como o EclipseLink), trocamos apenas as dependências e configurações no <code>persistence.xml</code> e o CDI se encarregará de injetar os objetos criados pelo provider (como o <code>EntityManager</code> discutido anteriormente).</p>
</div>
</div>
<div class="sect2">
<h3 id="_instanciando_um_entitymanager_para_manipular_dados_no_bd">4.6. Instanciando um EntityManager para manipular dados no BD</h3>
<div class="paragraph">
<p>A classe <code>EntityManager</code>, como dito anteriormente, controla o ciclo de vida de Entities (classes de negócio anotadas com <code>@Entity</code>) e permite persistir tais objetos no BD. Para instanciar um <code>EntityManager</code> precisaríamos de um objeto <code>EntityManagerFactory</code> que é uma fábrica de <code>EntityManagers</code>. No entanto, usando CDI, podemos injetar <code>EntityManagers</code> automaticamente, sempre que seu uso for necessário, sem precisarmos recorrer a um <code>EntityManagerFactory</code>.</p>
</div>
<div class="paragraph">
<p>Podemos injetar <code>EntityMangers</code> em classes que tenham o ciclo de vida controlado pelo servidor de aplicação. Para isso, precisaríamos declarar um objeto <code>EntityManager</code> e anotá-lo com <code>@PersistenceContext</code>. Porém, teríamos que utilizar esta anotação em todos os locais onde declarassemos tal objeto. Para não termos que fazer isso e centralizarmos o processo de injeção de qualquer <code>EntityManager</code> em um só lugar, vamos criar uma classe <code>Producers</code> dentro do pacote <code>com.manoelcampos.server.config</code>. A classe e o pacote podem ter qualquer nome que desejar. Esta classe representa um produtor (fábrica) de objetos e usará recursos do CDI para definir como determinados objetos mais complexos, como um <code>EntityManager</code>, devem ser criados. A classe deve ter o código apresentado a seguir:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.manoelcampos.server.config;

import javax.enterprise.inject.Produces;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

public class Producers {
    @Produces
    @PersistenceContext
    private EntityManager em;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>O código acima declara um <code>EntityManager</code> (EM) e o anota com <code>@PersistenceContext</code>. Assim, um EM será automaticamente injetado quando requisitado, utilizando as configurações definidas no <code>persistence.xml</code>. Como temos apenas uma Persistence Unit (PU) dentro de tal arquivo, não precisamos nos preocupar em definir o nome de tal PU ao anotar o <code>EntityManager</code>. Mas se quisessemos explicitar o nome da PU (que não é recomendável, pois este pode ser renomeado no arquivo xml), poderíamos alterar a anotação para <code>@PersistenceContext(name = "default")</code>, onde <code>default</code> foi o nome que demos pra nossa PU. Mas isso só é aconsolhável se tivermos mais de uma PU no <code>persistence.xml</code>.</p>
</div>
<div class="paragraph">
<p>Observe que o EM também está anotado com <code>@Produces</code>. Isto quer dizer que sempre que precisarmos de um EM, uma instância será criada neste atributo <code>em</code> e retornado para o local onde foi solicitado.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementando_o_padrão_dao">4.7. Implementando o padrão DAO</h3>
<div class="paragraph">
<p>Supondo que estamos desenvolvendo esta aplicação para um determinado cliente, nossas classes de negócio <code>Usuario</code> e <code>Cidade</code> são classes específicas do negócio do cliente. O EM disponibiliza métodos para persistir objetos no BD. Assim, para incluir, alterar ou excluir um objeto no BD, precisamos chamar estes métodos do EM.</p>
</div>
<div class="paragraph">
<p>Para não incluir tal código dentro das classes de negócio (que devem ter apenas código referente ao negócio do cliente), é comum a utilização do padrão <a href="https://pt.wikipedia.org/wiki/Objeto_de_acesso_a_dados">Data Access Object (DAO)</a> para permitir a separação de conceitos (<a href="https://pt.wikipedia.org/wiki/Separação_de_conceitos">Separation of Concerns, SoC</a>). Isto evita misturar código de um determinado nível de abstração com outros de outro nível. As classes de negócio como <code>Usuario</code> podem ter código para validar o CPF, enquanto operações de BD não estão relacionadas com o negócio e assim devem ser mantidas separadas.</p>
</div>
<div class="paragraph">
<p>Para implementar o padrão DAO, precisaríamos criar uma classe DAO para cada classe de negócio. Assim, teríamos uma classe <code>UsuarioDAO</code> e <code>CidadeDAO</code>. Como um DAO proverá métodos para manipular dados no BD, como <code>salvar</code> e <code>remover</code>, tais métodos acabam ficando duplicados entre os DAOs. Para evitar isso, podemos criar um DAO genérico que funciona para qualquer classe de negócio. Isto pode ter suas desvantagens, mas não vamos discutí-las nesse artigo.</p>
</div>
<div class="paragraph">
<p>Primeiro, vamos definir uma interface chamada DAO, dentro do pacote <code>com.manoelcampos.server.dao</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.manoelcampos.server.dao;

import com.manoelcampos.server.model.Cadastro;

public interface DAO&lt;T extends Cadastro&gt; {
    T findById(long id);
    T findByField(String fieldName, Object value);
    boolean remove(T entity);
    void save(T entity);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tal interface define métodos para:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>localizar um objeto no BD a partir do seu id (<code>findById</code>);</p>
</li>
<li>
<p>localizar por um campo específico (<code>findByField</code>);</p>
</li>
<li>
<p>remover (<code>remove</code>);</p>
</li>
<li>
<p>e salvar (<code>save</code>) um objeto no BD.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A interface usa <a href="https://en.wikipedia.org/wiki/Generics_in_Java">Generics</a> para permitir indicar qual o tipo de objeto de negócio (que implementa a interface <code>Cadastro</code>) um DAO trabalhará. Assim, quando mandarmos localizar um <code>Usuario</code> utilizando seu id, teremos como retorno um objeto <code>Usuario</code> e não um objeto genérico como <code>Object</code>. Generics é um assunto bem extenso que está fora do escopo deste artigo.</p>
</div>
<div class="paragraph">
<p>Agora que definimos uma interface padrão para nossos DAOs, vamos criar uma classe que utilizará JPA para implementar o DAO. Definir a interface e criar uma classe que a implementa é muito útil se desejarmos criar outras formas de persistência para nossos objetos de negócio. Por exemplo, poderíamos desejar persistir os objetos em um BD usando JPA e também em arquivos, utilizando o recurso de serialização do Java. Para isso, poderíamos ter classes DAO implementando diferentes mecanismos de persistência de dados.</p>
</div>
<div class="paragraph">
<p>Assim, crie a classe <code>JpaDAO</code> no pacote <code>com.manoelcampos.server.dao</code> como abaixo. Ela usa um <code>EntityManager</code> para persistir um objeto de negócio no BD. O tipo de objeto de negócio é definido utilizando Generics, como feito na interface <code>DAO</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.manoelcampos.server.dao;

import com.manoelcampos.server.model.Cadastro;
import javax.persistence.EntityManager;
import javax.persistence.Query;
import javax.persistence.TypedQuery;

public class JpaDAO&lt;T extends Cadastro&gt; implements DAO&lt;T&gt; {
    private final EntityManager em;
    private final Class&lt;T&gt; classe;

    public JpaDAO(EntityManager em, Class&lt;T&gt; classe){
        this.em = em;
        this.classe = classe;
    }

    @Override
    public T findById(long id) {
        return em.find(classe, id);
    }

    @Override
    public boolean remove(T entity) {
        em.remove(entity);
        return true;
    }

    @Override
    public void save(T entity) {
        em.persist(entity);
    }

    @Override
    public T findByField(String fieldName, Object value) {
        final String jpql = "select o from " + classe.getSimpleName() + " o " +
                            " where o." + fieldName + " = :" + fieldName;
        TypedQuery&lt;T&gt; query = em.createQuery(jpql, classe);
        query.setParameter(fieldName, value);
        return query.getSingleResult();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como pode ser observado acima, os métodos para fazer a manipulação dos dados no BD são extremamente simples. No entanto, a instanciação de um <code>JpaDAO</code> não é tão simples assim. Para criar tal objeto é preciso passar dois parâmetros para o construtor. Sempre que precisarmos instanciar um <code>JpaDAO</code>, precisaremos passar tais parâmetros. É nesses casos em que a injeção de dependências tem mais valor.</p>
</div>
<div class="paragraph">
<p>Quando usamos injeção de dependência com CDI, objetos podem ser criados automaticamente, desde que eles tenham um construtor padrão. Assim, não podemos injetar objetos DAO diretamente. Precisamos criar um código adicional para indicar ao CDI como objetos DAO devem ser criados, até porque se tivessemos mais de uma implementação do DAO, o CDI não saberia qual classe concreta instanciar para injetar um objeto que implementa a interface <code>DAO</code>.</p>
</div>
<div class="paragraph">
<p>A grande vantagem é que, apesar de termos um trablaho adicional para informar ao CDI como criar DAOs, teremos que fazer isso em um único lugar, ao invés de ter que passar esses parâmetros para criar um DAO em todo lugar que declararmos um. Para fazer isso, vamos alterar a classe <code>Producers</code> como abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.manoelcampos.server.config;

import com.manoelcampos.server.dao.DAO;
import com.manoelcampos.server.dao.JpaDAO;
import com.manoelcampos.server.model.Cadastro;
import java.lang.reflect.ParameterizedType;
import javax.enterprise.inject.Produces;
import javax.enterprise.inject.spi.InjectionPoint;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;

public class Producers {
    @Produces
    @PersistenceContext
    private EntityManager em;

    @Produces
    public &lt;T extends Cadastro&gt; DAO&lt;T&gt; getDao(InjectionPoint ip){
        ParameterizedType t = (ParameterizedType) ip.getType();
        Class classe = (Class) t.getActualTypeArguments()[0];
        return new JpaDAO(em, classe);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Neste caso, definimos um método anotado com <code>@Produces</code>, uma vez que para criar um DAO é bem mais complicado que criar um <code>EntityManager</code> usando CDI.
Este método será chamado automaticamente, toda vez que declararmos um objeto <code>DAO</code> e anotarmos ele com <code>@Inject</code> para indicar que um DAO deve ser injetado alí.</p>
</div>
<div class="paragraph">
<p>O parâmetro <code>ip</code> que tal método recebe, conterá informações sobre o local onde foi solicitada a injeção de um <code>DAO</code>. Como para declarar um <code>DAO</code>, por exemplo, para manipular objetos <code>Usuario</code> tem que ser feita como <code>@Inject DAO&lt;Usuario&gt; dao</code>, indicando quais objetos de negócio o <code>DAO</code> manipulará, este parâmetro <code>ip</code> fornecerá informações como qual tipo genérico (definido entre &lt; e &gt;) que está sendo associado ao <code>DAO</code>. Com isto, conseguimos obter a classe entre &lt; e &gt; e assim criar um <code>DAO</code> instanciando um objeto <code>JpaDAO</code>. Como tal objeto também requer um <code>EntityManager</code>, podemos simplesmente acessar o atributo <code>em</code>. Quando fizermos isso, um <code>EntityManager</code> será produzido e passado para o <code>JpaDAO</code> criado.</p>
</div>
</div>
<div class="sect2">
<h3 id="_implementando_o_servidor_rest">4.8. Implementando o Servidor REST</h3>
<div class="paragraph">
<p>Toda a infraestrutura da nossa aplicação está pronta. Agora, vamos criar nosso Web Service (WS) REST. Tal WS disponibilizará operações para manipular usuários no BD, assim como as operações definidas no <code>DAO</code>. Web Services REST são acessados normalmente por meio de URIs amigáveis. Cada URI dá acesso a um determinado recurso.</p>
</div>
<div class="paragraph">
<p>Na terminologia REST, um recurso pode ser um arquivo qualquer, uma imagem, um registro em um BD (como é o nosso caso), etc. Assim, para podermos disponibilizar as operações do <code>DAO</code> sobre objetos <code>Usuario</code> precisamos criar uma classe <code>UsuarioResource</code> no pacote <code>com.manoelcampos.server.rest</code>, como abaixo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.manoelcampos.server.rest;

import com.manoelcampos.server.dao.DAO;
import com.manoelcampos.server.model.Usuario;
import javax.inject.Inject;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

@Path("/usuario")
public class UsuarioResource {
    @Inject
    private DAO&lt;Usuario&gt; dao;

    @GET
    @Path("{id}")
    @Produces(MediaType.APPLICATION_JSON)
    public Usuario findById(@PathParam("id") long id) {
        return dao.findById(id);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para publicar tal classe como um recurso acessível via HTTP, devemos anotá-la com <code>@Path</code> e indicar o nome que será utilizado para acessar tal recurso por meio de uma URI. Neste caso, indicamos que um recurso <code>Usuario</code> poderá ser acessado a partir do nome <code>/usuario</code>. O acesso ao recurso só pode ser feito de fato quando acessa-se um determinado método da classe. Cada método então define um novo caminho a partir de <code>/usuario</code> que permitirá o método ser chamado por uma requisição HTTP. No caso do método <code>findById</code> (que possui o mesmo nome que no <code>DAO</code>), ele será acessado a partir de <code>/usuario/{id}</code>, onde <code>{id}</code> representa o id do usuário que deseja-se obter.</p>
</div>
<div class="paragraph">
<p>Observe que o método <code>findById</code> possui um parâmetro id. Quando utilizamos a anotação <code>@Path</code> para indicar qual o caminho a ser utilizado para acessar tal método via HTTP, definimos o nome como <code>{id}</code> (entre chaves), para indicar que <code>id</code> deve ser um valor a ser passado na URI após <code>/usuario</code>. Esta valor será passado automaticamente para o parâmetro id do método, uma vez que utilizamos a tag <code>@ParamPath</code> para indicar isso. Note que no <code>@ParamPath</code> não se usa chaves. Assim, se acessarmos uma URI terminada em <code>/usuario/1</code>, estamos indicando que desejamos obter o usuário de id igual a 1. Ou seja, o valor para o parâmetro <code>id</code> é obtido a partir da URI.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configurando_o_servidor_rest_e_executando_a_aplicação">4.9. Configurando o Servidor REST e executando a aplicação</h3>
<div class="paragraph">
<p>Para o recurso <code>Usuario</code> ficar de fato disponível via HTTP, precisamos habilitar o uso de REST no projeto. Para isto, basta criar uma classe como <code>RestConfig</code> no pacote <code>com.manoelcampos.server.config</code> (o nome da classe e do pacote podem ser qualquer um). Tal classe deve extender <code>javax.ws.rs.core.Application</code> e deve ser anotada com <code>@javax.ws.rs.ApplicationPath("api")</code>, onde <code>api</code> pode ser qualquer nome que indica a raiz a partir da qual os recursos (as classes anotadas com <code>@Path</code>), estarão disponíveis.</p>
</div>
<div class="paragraph">
<p>Uma vez que estamos rodando o GlassFish localmente e que nosso projeto chama <code>server</code>, a URL para acessar a aplicação seria <a href="http://localhost:8080/server/" class="bare">http://localhost:8080/server/</a>. Antes de acessar tal URL, precisamos clicar no botão <code>Build</code> para compilar todo o projeto. Sempre que salvamos o projeto, as classes alteradas são compiladas e o projeto é reimplantado (redeployed) automaticamente. Normalmente, como fizemos inúmeras alterações no projeto e nunca executamos o mesmo, é aconselhável clicar no botão <code>Clean and Build</code> (Limpar e Construir) para apagar quaisquer versões anteriores das classes e implantar as novas. Muitos erros ocorrem quando fazemos alterações estruturais no projeto e não usamos tal opção. Agora, podemos clicar no botão <code>Play</code> (F6) para executar o projeto. Sem isso, o WS REST não poderá ser acessadso.</p>
</div>
<div class="paragraph">
<p>Ao executar o projeto, uma página como <a href="http://localhost:8080/server/" class="bare">http://localhost:8080/server/</a> será acessada. A API REST estará disponível a partir de outro diretório, como especificado na anotação <code>@javax.ws.rs.ApplicationPath</code>. Neste caso, a URL base para acesso aos recursos será <a href="http://localhost:8080/server/api" class="bare">http://localhost:8080/server/api</a>.
Então, para acessar o método <code>findById</code> do recurso <code>Usuario</code>, a URI completa seria algo como <a href="http://localhost:8080/server/api/usuario/1" class="bare">http://localhost:8080/server/api/usuario/1</a>.</p>
</div>
<div class="paragraph">
<p>Se uma classe como a <code>RestConfig</code> não for criada, o NetBeans dará um aviso na linha da declaração de qualquer classe anotada com <code>@Path</code> e permitirá adicionar a classe de configuração automaticamente. No entanto, tal classe precisa apenas ter o código mínimo definido abaixo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.manoelcampos.server.config;

import javax.ws.rs.core.Application;

@javax.ws.rs.ApplicationPath("api")
public class RestConfig extends Application {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>No entanto, o NetBeans adicionará código dentro de tal classe que de fato não funcionará (pelo menos não para as versões de bibliotecas e ferramentas utilizadas). Assim, se usar o recurso do NetBeans para criar tal classe, tenha certeza de apagar o código entre as chaves, deixando a classe vazia como acima. Lembre também de definir o nome pelo qual deseja acessar os recursos por meio de REST.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-02-27 16:17:42 -03
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>